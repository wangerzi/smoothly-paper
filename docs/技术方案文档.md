# è®ºæ–‡æµç•…è¯» - æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**ï¼šSmoothly Paperï¼ˆè®ºæ–‡æµç•…è¯»ï¼‰
- **æŠ€æœ¯ç‰ˆæœ¬**ï¼šv1.0 MVP
- **æ¶æ„æ¨¡å¼**ï¼šæœ¬åœ°ä¼˜å…ˆ (Local-First) + AI å¢å¼º
- **åˆ›å»ºæ—¥æœŸ**ï¼š2025-11-19
- **ç›®æ ‡å¹³å°**ï¼šmacOS / Windows / Linux (æ¡Œé¢ç«¯ Web)

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„æ€»è§ˆ

### æ¶æ„åŸåˆ™

1. **æœ¬åœ°ä¼˜å…ˆ**ï¼šé™¤ AI è°ƒç”¨å¤–ï¼Œæ‰€æœ‰åŠŸèƒ½æœ¬åœ°è¿è¡Œ
2. **é›¶é…ç½®å¯åŠ¨**ï¼šç”¨æˆ·æ— éœ€å¤æ‚è®¾ç½®
3. **æ•°æ®éšç§**ï¼šè®ºæ–‡æ•°æ®ä¸ä¸Šä¼ äº‘ç«¯
4. **å¯æ‰©å±•æ€§**ï¼šé¢„ç•™åç»­åŠŸèƒ½æ‰©å±•æ¥å£

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·æµè§ˆå™¨                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         Next.js å‰ç«¯åº”ç”¨ (React)              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ä¸Šä¼ ç•Œé¢ â”‚  â”‚é˜…è¯»ç•Œé¢ â”‚  â”‚ UI ç»„ä»¶åº“    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â†• API è°ƒç”¨ (å†…éƒ¨)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚       Next.js API Routes (åç«¯é€»è¾‘)           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚PDF è§£æ  â”‚  â”‚AI æœåŠ¡   â”‚  â”‚æ•°æ®ç®¡ç†   â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†• æ–‡ä»¶ç³»ç»Ÿ                â†• å¤–éƒ¨ API
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  æœ¬åœ°å­˜å‚¨     â”‚         â”‚ OpenAI API   â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚  (GPT-4)     â”‚
    â”‚ â”‚SQLite DB  â”‚ â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ â”‚Papersæ–‡ä»¶ â”‚ â”‚          (å”¯ä¸€å¤–éƒ¨ä¾èµ–)
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆé€‰å‹

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|---------|
| **Next.js** | 14.x | React æ¡†æ¶ | å…¨æ ˆæ”¯æŒï¼Œé›¶é…ç½®ï¼Œæ€§èƒ½ä¼˜ç§€ |
| **React** | 18.x | UI åº“ | ç”Ÿæ€æˆç†Ÿï¼Œç»„ä»¶åŒ–å¼€å‘ |
| **TypeScript** | 5.x | ç±»å‹ç³»ç»Ÿ | ç±»å‹å®‰å…¨ï¼Œå‡å°‘é”™è¯¯ |
| **Tailwind CSS** | 3.4.x | æ ·å¼æ¡†æ¶ | å¿«é€Ÿå¼€å‘ï¼Œé«˜åº¦å®šåˆ¶ |
| **shadcn/ui** | æœ€æ–° | ç»„ä»¶åº“ | ç¾è§‚ç°ä»£ï¼Œå¼€ç®±å³ç”¨ |
| **Framer Motion** | 11.x | åŠ¨ç”»åº“ | æµç•…åŠ¨ç”»ï¼Œæ˜“äºä½¿ç”¨ |
| **Lucide React** | 0.300.x | å›¾æ ‡åº“ | å›¾æ ‡ä¸°å¯Œï¼Œä½“ç§¯å° |
| **pdf.js** | 4.x | PDF æ¸²æŸ“ | Mozilla å®˜æ–¹ï¼Œç¨³å®šå¯é  |

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|---------|
| **Node.js** | 18+ | è¿è¡Œæ—¶ | ä¸å‰ç«¯åŒè¯­è¨€ï¼Œç”Ÿæ€ä¸°å¯Œ |
| **Next.js API Routes** | 14.x | API æœåŠ¡ | ä¸å‰ç«¯ä¸€ä½“ï¼Œç®€åŒ–éƒ¨ç½² |
| **pdf-parse** | 1.1.x | PDF è§£æ | è½»é‡çº§ï¼Œçº¯ JS å®ç° |
| **better-sqlite3** | 9.x | æ•°æ®åº“ | æœ¬åœ°æ–‡ä»¶æ•°æ®åº“ï¼Œé›¶é…ç½® |
| **zod** | 3.x | æ•°æ®éªŒè¯ | TypeScript ä¼˜å…ˆï¼Œç±»å‹å®‰å…¨ |

### AI / ML æŠ€æœ¯

| æœåŠ¡ | ç”¨é€” | å¤‡é€‰æ–¹æ¡ˆ |
|------|------|---------|
| **OpenAI GPT-4** | æ–‡æœ¬åˆ†æã€ç¿»è¯‘ã€è§£é‡Š | Claude 3.5 / Gemini Pro |
| **OpenAI Embeddings** | (v2.0) è¯­ä¹‰æœç´¢ | æœ¬åœ°å‘é‡åº“ |

### å¼€å‘å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| **VS Code** | ä»£ç ç¼–è¾‘å™¨ |
| **ESLint + Prettier** | ä»£ç è§„èŒƒ |
| **Git** | ç‰ˆæœ¬ç®¡ç† |
| **pnpm** | åŒ…ç®¡ç†å™¨ï¼ˆæ¯” npm æ›´å¿«ï¼‰|

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
smoothly-paper/
â”œâ”€â”€ app/                          # Next.js 14 App Router
â”‚   â”œâ”€â”€ layout.tsx               # å…¨å±€å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx                 # é¦–é¡µï¼ˆä¸Šä¼ ç•Œé¢ï¼‰
â”‚   â”œâ”€â”€ globals.css              # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ providers.tsx            # Context Providers
â”‚   â”‚
â”‚   â”œâ”€â”€ upload/                  # ä¸Šä¼ é¡µé¢
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ read/[id]/              # é˜…è¯»é¡µé¢ï¼ˆåŠ¨æ€è·¯ç”±ï¼‰
â”‚   â”‚   â”œâ”€â”€ page.tsx            # ä¸»é¡µé¢
â”‚   â”‚   â””â”€â”€ loading.tsx         # åŠ è½½çŠ¶æ€
â”‚   â”‚
â”‚   â””â”€â”€ api/                     # API è·¯ç”±
â”‚       â”œâ”€â”€ upload/
â”‚       â”‚   â””â”€â”€ route.ts        # POST /api/upload
â”‚       â”œâ”€â”€ analyze/
â”‚       â”‚   â””â”€â”€ route.ts        # POST /api/analyze
â”‚       â”œâ”€â”€ papers/
â”‚       â”‚   â”œâ”€â”€ route.ts        # GET /api/papers
â”‚       â”‚   â””â”€â”€ [id]/
â”‚       â”‚       â””â”€â”€ route.ts    # GET /api/papers/:id
â”‚       â””â”€â”€ ai/
â”‚           â”œâ”€â”€ summarize/
â”‚           â”‚   â””â”€â”€ route.ts    # AI æ€»ç»“æ¥å£
â”‚           â”œâ”€â”€ segment/
â”‚           â”‚   â””â”€â”€ route.ts    # æ™ºèƒ½åˆ†æ®µ
â”‚           â””â”€â”€ annotate/
â”‚               â””â”€â”€ route.ts    # éš¾ç‚¹æ ‡æ³¨
â”‚
â”œâ”€â”€ components/                  # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/                     # shadcn/ui åŸºç¡€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ tabs.tsx
â”‚   â”‚   â”œâ”€â”€ tooltip.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ layout/                 # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ upload/                 # ä¸Šä¼ ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ UploadZone.tsx     # æ‹–æ‹½ä¸Šä¼ åŒº
â”‚   â”‚   â”œâ”€â”€ LevelSelector.tsx  # æ°´å¹³é€‰æ‹©å™¨
â”‚   â”‚   â””â”€â”€ UploadProgress.tsx # ä¸Šä¼ è¿›åº¦
â”‚   â”‚
â”‚   â”œâ”€â”€ reading/               # é˜…è¯»ç•Œé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ TableOfContents.tsx # ç›®å½•å¯¼èˆª
â”‚   â”‚   â”œâ”€â”€ PaperContent.tsx    # è®ºæ–‡æ­£æ–‡
â”‚   â”‚   â”œâ”€â”€ AssistantPanel.tsx  # è¾…åŠ©é¢æ¿
â”‚   â”‚   â”œâ”€â”€ WordTooltip.tsx     # ç”Ÿè¯æç¤º
â”‚   â”‚   â””â”€â”€ ProgressTracker.tsx # è¿›åº¦è¿½è¸ª
â”‚   â”‚
â”‚   â””â”€â”€ effects/               # ç‰¹æ•ˆç»„ä»¶
â”‚       â”œâ”€â”€ ParticleBackground.tsx # ç²’å­èƒŒæ™¯
â”‚       â”œâ”€â”€ LoadingSpinner.tsx     # åŠ è½½åŠ¨ç”»
â”‚       â””â”€â”€ GlassCard.tsx          # æ¯›ç»ç’ƒå¡ç‰‡
â”‚
â”œâ”€â”€ lib/                        # æ ¸å¿ƒå·¥å…·åº“
â”‚   â”œâ”€â”€ db/                    # æ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ schema.ts          # æ•°æ®åº“è¡¨ç»“æ„
â”‚   â”‚   â”œâ”€â”€ client.ts          # SQLite å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ operations.ts      # CRUD æ“ä½œ
â”‚   â”‚
â”‚   â”œâ”€â”€ pdf/                   # PDF å¤„ç†
â”‚   â”‚   â”œâ”€â”€ parser.ts          # PDF è§£æ
â”‚   â”‚   â”œâ”€â”€ extractor.ts       # æ–‡æœ¬æå–
â”‚   â”‚   â””â”€â”€ types.ts           # ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ ai/                    # AI æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ openai.ts          # OpenAI å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ prompts.ts         # Prompt æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ analyzer.ts        # æ–‡æœ¬åˆ†æ
â”‚   â”‚   â””â”€â”€ translator.ts      # ç¿»è¯‘æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ vocabulary/            # è¯æ±‡ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ levels.ts          # è¯æ±‡ç­‰çº§å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ dictionary.ts      # è¯å…¸æ¥å£
â”‚   â”‚   â””â”€â”€ annotator.ts       # éš¾è¯æ ‡æ³¨é€»è¾‘
â”‚   â”‚
â”‚   â””â”€â”€ utils/                 # é€šç”¨å·¥å…·
â”‚       â”œâ”€â”€ cn.ts              # className åˆå¹¶
â”‚       â”œâ”€â”€ format.ts          # æ ¼å¼åŒ–å‡½æ•°
â”‚       â””â”€â”€ constants.ts       # å¸¸é‡å®šä¹‰
â”‚
â”œâ”€â”€ hooks/                      # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ useUpload.ts           # ä¸Šä¼ é€»è¾‘
â”‚   â”œâ”€â”€ usePaper.ts            # è®ºæ–‡æ•°æ®
â”‚   â”œâ”€â”€ useReading.ts          # é˜…è¯»çŠ¶æ€
â”‚   â””â”€â”€ useAI.ts               # AI è°ƒç”¨
â”‚
â”œâ”€â”€ types/                      # TypeScript ç±»å‹
â”‚   â”œâ”€â”€ paper.ts               # è®ºæ–‡ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ annotation.ts          # æ ‡æ³¨ç±»å‹
â”‚   â””â”€â”€ api.ts                 # API å“åº”ç±»å‹
â”‚
â”œâ”€â”€ data/                       # æœ¬åœ°æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ papers.db              # SQLite æ•°æ®åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ uploads/               # ä¸Šä¼ çš„ PDF æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ [paper-id].pdf
â”‚   â””â”€â”€ cache/                 # AI å“åº”ç¼“å­˜
â”‚
â”œâ”€â”€ public/                     # é™æ€èµ„æº
â”‚   â”œâ”€â”€ fonts/                 # å­—ä½“æ–‡ä»¶
â”‚   â””â”€â”€ images/                # å›¾ç‰‡èµ„æº
â”‚
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ äº§å“éœ€æ±‚æ–‡æ¡£.md
â”‚   â”œâ”€â”€ UI è®¾è®¡å’Œäº¤äº’æ–‡æ¡£.md
â”‚   â””â”€â”€ æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£.md (æœ¬æ–‡ä»¶)
â”‚
â”œâ”€â”€ tests/                      # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/                  # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ integration/           # é›†æˆæµ‹è¯•
â”‚
â”œâ”€â”€ .env.local                 # ç¯å¢ƒå˜é‡ï¼ˆæœ¬åœ°ï¼‰
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore                 # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ next.config.js             # Next.js é…ç½®
â”œâ”€â”€ tailwind.config.ts         # Tailwind é…ç½®
â”œâ”€â”€ tsconfig.json              # TypeScript é…ç½®
â”œâ”€â”€ package.json               # ä¾èµ–ç®¡ç†
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### SQLite Schema

```sql
-- è®ºæ–‡è¡¨
CREATE TABLE papers (
  id TEXT PRIMARY KEY,              -- UUID
  filename TEXT NOT NULL,           -- åŸå§‹æ–‡ä»¶å
  title TEXT,                       -- è®ºæ–‡æ ‡é¢˜ï¼ˆAIæå–ï¼‰
  file_path TEXT NOT NULL,          -- PDFæ–‡ä»¶è·¯å¾„
  file_size INTEGER,                -- æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  page_count INTEGER,               -- é¡µæ•°
  upload_time DATETIME DEFAULT CURRENT_TIMESTAMP,
  user_level TEXT CHECK(user_level IN ('beginner', 'intermediate', 'advanced')),
  status TEXT CHECK(status IN ('uploading', 'processing', 'completed', 'failed')),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- è®ºæ–‡å†…å®¹è¡¨ï¼ˆå…¨æ–‡ï¼‰
CREATE TABLE paper_contents (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  paper_id TEXT NOT NULL,
  full_text TEXT NOT NULL,          -- å®Œæ•´æå–çš„æ–‡æœ¬
  summary TEXT,                     -- AIç”Ÿæˆçš„æ‘˜è¦
  FOREIGN KEY (paper_id) REFERENCES papers(id) ON DELETE CASCADE
);

-- æ®µè½è¡¨
CREATE TABLE paragraphs (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  paper_id TEXT NOT NULL,
  section TEXT,                     -- ç« èŠ‚åï¼ˆAbstract, Introductionç­‰ï¼‰
  order_index INTEGER,              -- æ®µè½é¡ºåº
  content TEXT NOT NULL,            -- æ®µè½åŸæ–‡
  translation TEXT,                 -- ä¸­æ–‡ç¿»è¯‘
  word_count INTEGER,               -- è¯æ•°
  FOREIGN KEY (paper_id) REFERENCES papers(id) ON DELETE CASCADE
);

-- æœ¯è¯­è¡¨
CREATE TABLE terms (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  paragraph_id INTEGER NOT NULL,
  term TEXT NOT NULL,               -- æœ¯è¯­åŸæ–‡
  definition TEXT,                  -- ä¸­æ–‡å®šä¹‰
  context TEXT,                     -- ä¸Šä¸‹æ–‡è§£é‡Š
  category TEXT,                    -- ç±»åˆ«ï¼ˆç®—æ³•ã€æ¨¡å‹ã€æŒ‡æ ‡ç­‰ï¼‰
  FOREIGN KEY (paragraph_id) REFERENCES paragraphs(id) ON DELETE CASCADE
);

-- éš¾è¯è¡¨
CREATE TABLE difficult_words (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  paragraph_id INTEGER NOT NULL,
  word TEXT NOT NULL,               -- å•è¯
  phonetic TEXT,                    -- éŸ³æ ‡
  part_of_speech TEXT,              -- è¯æ€§
  definition TEXT,                  -- é‡Šä¹‰
  difficulty_level TEXT CHECK(difficulty_level IN ('easy', 'medium', 'hard')),
  position_start INTEGER,           -- åœ¨æ®µè½ä¸­çš„èµ·å§‹ä½ç½®
  position_end INTEGER,             -- åœ¨æ®µè½ä¸­çš„ç»“æŸä½ç½®
  FOREIGN KEY (paragraph_id) REFERENCES paragraphs(id) ON DELETE CASCADE
);

-- å¥æ³•åˆ†æè¡¨
CREATE TABLE syntax_analyses (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  paragraph_id INTEGER NOT NULL,
  sentence TEXT NOT NULL,           -- åŸå¥
  structure TEXT,                   -- å¥å­ç»“æ„ï¼ˆJSONæ ¼å¼ï¼‰
  explanation TEXT,                 -- è¯­æ³•è§£é‡Š
  FOREIGN KEY (paragraph_id) REFERENCES paragraphs(id) ON DELETE CASCADE
);

-- é˜…è¯»è¿›åº¦è¡¨ï¼ˆå¯é€‰ï¼Œv2.0ï¼‰
CREATE TABLE reading_progress (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  paper_id TEXT NOT NULL,
  current_paragraph_id INTEGER,
  progress_percentage REAL,
  last_read_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (paper_id) REFERENCES papers(id) ON DELETE CASCADE
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_papers_status ON papers(status);
CREATE INDEX idx_paragraphs_paper_id ON paragraphs(paper_id);
CREATE INDEX idx_paragraphs_order ON paragraphs(paper_id, order_index);
CREATE INDEX idx_terms_paragraph ON terms(paragraph_id);
CREATE INDEX idx_words_paragraph ON difficult_words(paragraph_id);
```

### æ•°æ®æµè½¬

```
1. ç”¨æˆ·ä¸Šä¼  PDF
   â†“
2. åˆ›å»º papers è®°å½• (status: 'uploading')
   â†“
3. ä¿å­˜ PDF åˆ° data/uploads/
   â†“
4. æå–æ–‡æœ¬ â†’ paper_contents
   â†“
5. AI åˆ†æï¼ˆå¼‚æ­¥ï¼‰ï¼š
   - ç”Ÿæˆæ‘˜è¦ â†’ æ›´æ–° paper_contents.summary
   - æ™ºèƒ½åˆ†æ®µ â†’ åˆ›å»º paragraphs è®°å½•
   - æ¯æ®µåˆ†æ â†’ åˆ›å»º terms, difficult_words, syntax_analyses
   â†“
6. æ›´æ–° papers.status = 'completed'
   â†“
7. ç”¨æˆ·è®¿é—®é˜…è¯»é¡µé¢ â†’ æŸ¥è¯¢æ‰€æœ‰å…³è”æ•°æ®
```

---

## ğŸ¤– AI æœåŠ¡è®¾è®¡

### OpenAI API é…ç½®

```typescript
// lib/ai/openai.ts
import OpenAI from 'openai';

export const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
  baseURL: process.env.OPENAI_BASE_URL, // å¯é€‰ï¼šä½¿ç”¨ä»£ç†
});

export const MODEL = 'gpt-4-turbo-preview'; // æˆ– 'gpt-4'
export const MAX_TOKENS = 4096;
export const TEMPERATURE = 0.3; // è¾ƒä½æ¸©åº¦ä¿è¯å‡†ç¡®æ€§
```

### Prompt å·¥ç¨‹

#### 1. è®ºæ–‡æ€»ç»“ Prompt

```typescript
// lib/ai/prompts.ts
export const SUMMARIZE_PROMPT = `
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å­¦æœ¯è®ºæ–‡åˆ†æä¸“å®¶ã€‚è¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹è‹±æ–‡å­¦æœ¯è®ºæ–‡ï¼Œå¹¶ç”Ÿæˆä¸€ä»½ç»“æ„åŒ–çš„ä¸­æ–‡æ‘˜è¦ã€‚

è¦æ±‚ï¼š
1. å­—æ•°ï¼š200-300å­—
2. å¿…é¡»åŒ…å«ä»¥ä¸‹è¦ç´ ï¼š
   - ç ”ç©¶èƒŒæ™¯ï¼ˆ1-2å¥ï¼‰
   - æ ¸å¿ƒé—®é¢˜ï¼ˆ1å¥ï¼‰
   - ç ”ç©¶æ–¹æ³•ï¼ˆ2-3å¥ï¼‰
   - ä¸»è¦å‘ç°ï¼ˆ2-3å¥ï¼‰
   - ç»“è®ºæ„ä¹‰ï¼ˆ1-2å¥ï¼‰
3. è¯­è¨€ç®€æ´ä¸“ä¸šï¼Œé€‚åˆå­¦æœ¯ç ”ç©¶è€…é˜…è¯»
4. ä¿ç•™å…³é”®æœ¯è¯­çš„è‹±æ–‡åŸæ–‡ï¼Œç”¨æ‹¬å·æ ‡æ³¨ä¸­æ–‡

è®ºæ–‡å…¨æ–‡ï¼š
{paper_text}

è¯·æŒ‰ä»¥ä¸‹ JSON æ ¼å¼è¾“å‡ºï¼š
{
  "summary": "ç»“æ„åŒ–æ‘˜è¦",
  "background": "ç ”ç©¶èƒŒæ™¯",
  "problem": "æ ¸å¿ƒé—®é¢˜",
  "method": "ç ”ç©¶æ–¹æ³•",
  "findings": "ä¸»è¦å‘ç°",
  "significance": "ç»“è®ºæ„ä¹‰",
  "keywords": ["å…³é”®è¯1", "å…³é”®è¯2", ...]
}
`;
```

#### 2. æ™ºèƒ½åˆ†æ®µ Prompt

```typescript
export const SEGMENT_PROMPT = `
è¯·å°†ä»¥ä¸‹å­¦æœ¯è®ºæ–‡æ–‡æœ¬è¿›è¡Œæ™ºèƒ½åˆ†æ®µå¤„ç†ï¼š

è¦æ±‚ï¼š
1. è¯†åˆ«è®ºæ–‡çš„æ ‡å‡†ç»“æ„ï¼ˆAbstract, Introduction, Methods, Results, Discussion, Conclusionï¼‰
2. å°†æ¯ä¸ªå¤§ç« èŠ‚ä¸‹çš„é•¿æ®µè½æ‹†åˆ†ä¸ºå°æ®µï¼ˆæ¯æ®µ150-300è¯ï¼‰
3. ä¿æŒæ®µè½è¯­ä¹‰çš„å®Œæ•´æ€§ï¼Œä¸è¦åœ¨å¥å­ä¸­é—´æ–­å¼€
4. ä¸ºæ¯ä¸ªæ®µè½æ·»åŠ åºå·å’Œæ‰€å±ç« èŠ‚æ ‡è®°

è®ºæ–‡æ–‡æœ¬ï¼š
{paper_text}

è¾“å‡ºæ ¼å¼ï¼ˆJSONæ•°ç»„ï¼‰ï¼š
[
  {
    "section": "Abstract",
    "order": 1,
    "content": "æ®µè½å†…å®¹...",
    "word_count": 180
  },
  ...
]
`;
```

#### 3. éš¾ç‚¹æ ‡æ³¨ Prompt

```typescript
export const ANNOTATE_PROMPT = `
ä½ æ˜¯ä¸€ä½è‹±è¯­æ•™å­¦ä¸“å®¶ã€‚è¯·åˆ†æä»¥ä¸‹æ®µè½ï¼Œæ ‡æ³¨å‡ºå¯¹äº{level}æ°´å¹³çš„å­¦ä¹ è€…æ¥è¯´çš„éš¾ç‚¹ã€‚

ç”¨æˆ·æ°´å¹³ï¼š{level}
- beginner: è¯æ±‡é‡3000-4000ï¼ˆé«˜ä¸­/CET-4ï¼‰
- intermediate: è¯æ±‡é‡5000-6000ï¼ˆCET-6/è€ƒç ”ï¼‰
- advanced: è¯æ±‡é‡8000+ï¼ˆä¸“ä¸šå­¦æœ¯ï¼‰

æ®µè½å†…å®¹ï¼š
{paragraph}

è¯·è¾“å‡ºä»¥ä¸‹å†…å®¹ï¼ˆJSONæ ¼å¼ï¼‰ï¼š

{
  "terms": [
    {
      "term": "ä¸“ä¸šæœ¯è¯­åŸæ–‡",
      "definition": "ä¸­æ–‡å®šä¹‰",
      "context": "åœ¨æœ¬æ–‡ä¸­çš„å…·ä½“å«ä¹‰",
      "category": "ç±»åˆ«ï¼ˆç®—æ³•/æ¨¡å‹/æŒ‡æ ‡ç­‰ï¼‰"
    }
  ],
  "difficult_words": [
    {
      "word": "å•è¯",
      "phonetic": "/fÉ™ËˆnetÉªk/",
      "part_of_speech": "è¯æ€§",
      "definition": "ä¸­æ–‡é‡Šä¹‰",
      "difficulty_level": "easy|medium|hard",
      "position_start": èµ·å§‹å­—ç¬¦ä½ç½®,
      "position_end": ç»“æŸå­—ç¬¦ä½ç½®
    }
  ],
  "complex_sentences": [
    {
      "sentence": "å¤æ‚é•¿å¥",
      "structure": "å¥å­ç»“æ„åˆ†æï¼ˆä¸»å¥+ä»å¥ï¼‰",
      "explanation": "é€šä¿—æ˜“æ‡‚çš„è¯­æ³•è§£é‡Š"
    }
  ],
  "translation": "æ®µè½çš„å‡†ç¡®ä¸­æ–‡ç¿»è¯‘"
}

æ³¨æ„ï¼š
1. æ ¹æ®ç”¨æˆ·æ°´å¹³è°ƒæ•´æ ‡æ³¨å¯†åº¦
2. æœ¯è¯­å¿…é¡»æ ‡æ³¨ï¼Œæ— è®ºç”¨æˆ·æ°´å¹³å¦‚ä½•
3. ç¿»è¯‘è¦å‡†ç¡®ä¸“ä¸šï¼Œä¿ç•™å­¦æœ¯ä¸¥è°¨æ€§
`;
```

### API è°ƒç”¨å°è£…

```typescript
// lib/ai/analyzer.ts
import { openai, MODEL } from './openai';
import { SUMMARIZE_PROMPT, ANNOTATE_PROMPT } from './prompts';

export async function analyzePaper(paperText: string, userLevel: string) {
  try {
    // 1. ç”Ÿæˆæ‘˜è¦
    const summaryResponse = await openai.chat.completions.create({
      model: MODEL,
      messages: [
        {
          role: 'system',
          content: 'You are an academic paper analysis expert.',
        },
        {
          role: 'user',
          content: SUMMARIZE_PROMPT.replace('{paper_text}', paperText),
        },
      ],
      temperature: 0.3,
      response_format: { type: 'json_object' },
    });

    const summary = JSON.parse(summaryResponse.choices[0].message.content);

    // 2. æ™ºèƒ½åˆ†æ®µï¼ˆå¯èƒ½éœ€è¦åˆ†æ‰¹å¤„ç†ï¼‰
    const paragraphs = await segmentPaper(paperText);

    // 3. é€æ®µæ ‡æ³¨ï¼ˆå¹¶å‘å¤„ç†ï¼Œé™åˆ¶å¹¶å‘æ•°ï¼‰
    const annotations = await Promise.all(
      paragraphs.map((p) => annotateParagraph(p.content, userLevel))
    );

    return {
      summary,
      paragraphs: paragraphs.map((p, i) => ({
        ...p,
        ...annotations[i],
      })),
    };
  } catch (error) {
    console.error('AI analysis failed:', error);
    throw new Error('AI åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
  }
}

// é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
async function annotateParagraph(
  paragraph: string,
  level: string,
  retries = 3
) {
  for (let i = 0; i < retries; i++) {
    try {
      const response = await openai.chat.completions.create({
        model: MODEL,
        messages: [
          {
            role: 'user',
            content: ANNOTATE_PROMPT.replace('{paragraph}', paragraph).replace(
              '{level}',
              level
            ),
          },
        ],
        response_format: { type: 'json_object' },
      });

      return JSON.parse(response.choices[0].message.content);
    } catch (error) {
      if (i === retries - 1) throw error;
      await new Promise((resolve) => setTimeout(resolve, 1000 * (i + 1))); // æŒ‡æ•°é€€é¿
    }
  }
}
```

---

## ğŸ“„ PDF å¤„ç†æ–¹æ¡ˆ

### æ–‡æœ¬æå–

```typescript
// lib/pdf/parser.ts
import pdf from 'pdf-parse';
import fs from 'fs/promises';

export async function extractTextFromPDF(filePath: string) {
  try {
    const dataBuffer = await fs.readFile(filePath);
    const data = await pdf(dataBuffer);

    return {
      text: data.text,
      pageCount: data.numpages,
      info: data.info,
      metadata: data.metadata,
    };
  } catch (error) {
    console.error('PDF parsing error:', error);
    throw new Error('PDF è§£æå¤±è´¥ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æœªæŸå');
  }
}

// æ–‡æœ¬æ¸…æ´—
export function cleanPaperText(rawText: string): string {
  return (
    rawText
      // ç§»é™¤å¤šä½™ç©ºè¡Œ
      .replace(/\n{3,}/g, '\n\n')
      // ç§»é™¤é¡µçœ‰é¡µè„šï¼ˆç®€å•è§„åˆ™ï¼‰
      .replace(/^\d+\s*$/gm, '')
      // ä¿®å¤è¿å­—ç¬¦æ¢è¡Œ
      .replace(/(\w+)-\s*\n\s*(\w+)/g, '$1$2')
      // ç»Ÿä¸€ç©ºæ ¼
      .replace(/\s+/g, ' ')
      .trim()
  );
}
```

### å‰ç«¯ PDF æ˜¾ç¤ºï¼ˆå¯é€‰ï¼Œv2.0ï¼‰

```typescript
// components/reading/PDFViewer.tsx
import { useState } from 'react';
import { Document, Page, pdfjs } from 'react-pdf';

pdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.min.js`;

export function PDFViewer({ fileUrl }: { fileUrl: string }) {
  const [numPages, setNumPages] = useState<number>(0);
  const [pageNumber, setPageNumber] = useState<number>(1);

  return (
    <Document file={fileUrl} onLoadSuccess={({ numPages }) => setNumPages(numPages)}>
      <Page pageNumber={pageNumber} />
    </Document>
  );
}
```

---

## ğŸ” ç¯å¢ƒå˜é‡é…ç½®

### .env.example

```bash
# OpenAI API é…ç½®
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_BASE_URL=https://api.openai.com/v1  # å¯é€‰ï¼šä½¿ç”¨ä»£ç†

# åº”ç”¨é…ç½®
APP_ENV=development
APP_PORT=3000
APP_HOST=localhost

# æ•°æ®åº“é…ç½®
DATABASE_PATH=./data/papers.db

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_DIR=./data/uploads
MAX_FILE_SIZE=20971520  # 20MB in bytes

# AI é…ç½®
AI_MODEL=gpt-4-turbo-preview
AI_MAX_TOKENS=4096
AI_TEMPERATURE=0.3

# åŠŸèƒ½å¼€å…³
ENABLE_CACHE=true
ENABLE_ANALYTICS=false
```

### å®‰å…¨æ€§è€ƒè™‘

1. **API Key ä¿æŠ¤**ï¼š
   - ä»…åœ¨æœåŠ¡ç«¯è°ƒç”¨ AI API
   - æ°¸è¿œä¸è¦å°† API Key æš´éœ²åˆ°å‰ç«¯
   - ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯

2. **æ–‡ä»¶ä¸Šä¼ å®‰å…¨**ï¼š
   - é™åˆ¶æ–‡ä»¶å¤§å°ï¼ˆ20MBï¼‰
   - éªŒè¯æ–‡ä»¶ç±»å‹ï¼ˆä»… PDFï¼‰
   - ç”Ÿæˆéšæœºæ–‡ä»¶åé˜²æ­¢è·¯å¾„éå†

3. **SQL æ³¨å…¥é˜²æŠ¤**ï¼š
   - ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
   - è¾“å…¥éªŒè¯å’Œæ¸…æ´—

---

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd smoothly-paper

# 2. å®‰è£…ä¾èµ–
pnpm install

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env.local
# ç¼–è¾‘ .env.localï¼Œå¡«å…¥ OpenAI API Key

# 4. åˆå§‹åŒ–æ•°æ®åº“
pnpm run db:init

# 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm run dev

# è®¿é—® http://localhost:3000
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼ˆæœ¬åœ°è¿è¡Œï¼‰

#### æ–¹æ¡ˆä¸€ï¼šç›´æ¥è¿è¡Œ

```bash
# 1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm run build

# 2. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
pnpm run start
```

#### æ–¹æ¡ˆäºŒï¼šDocker å®¹å™¨ï¼ˆæ¨èï¼‰

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY package.json pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install --frozen-lockfile

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN pnpm run build

# åˆ›å»ºæ•°æ®ç›®å½•
RUN mkdir -p /app/data/uploads

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨åº”ç”¨
CMD ["pnpm", "start"]
```

```bash
# æ„å»ºé•œåƒ
docker build -t smoothly-paper .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 3000:3000 \
  -v $(pwd)/data:/app/data \
  -e OPENAI_API_KEY=your-key \
  --name smoothly-paper \
  smoothly-paper
```

#### æ–¹æ¡ˆä¸‰ï¼šElectron æ¡Œé¢åº”ç”¨ï¼ˆv2.0ï¼‰

å°† Web åº”ç”¨æ‰“åŒ…ä¸ºæ¡Œé¢åº”ç”¨ï¼š

```bash
# ä½¿ç”¨ Electron Builder
npm install electron electron-builder -D

# é…ç½® electron-builder.json
# æ‰“åŒ…ä¸º .dmg (macOS) / .exe (Windows) / .AppImage (Linux)
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### å‰ç«¯ä¼˜åŒ–

1. **ä»£ç åˆ†å‰²**
```typescript
// app/read/[id]/page.tsx
import dynamic from 'next/dynamic';

// æ‡’åŠ è½½é‡å‹ç»„ä»¶
const AssistantPanel = dynamic(() => import('@/components/reading/AssistantPanel'), {
  loading: () => <Skeleton />,
  ssr: false,
});
```

2. **è™šæ‹Ÿæ»šåŠ¨**
```typescript
// ä½¿ç”¨ react-window å¤„ç†é•¿åˆ—è¡¨
import { FixedSizeList } from 'react-window';

<FixedSizeList
  height={600}
  itemCount={paragraphs.length}
  itemSize={300}
  width="100%"
>
  {({ index, style }) => (
    <div style={style}>
      <Paragraph data={paragraphs[index]} />
    </div>
  )}
</FixedSizeList>
```

3. **å›¾ç‰‡ä¼˜åŒ–**
```tsx
import Image from 'next/image';

<Image
  src="/logo.png"
  alt="Logo"
  width={200}
  height={100}
  priority // é¦–å±å›¾ç‰‡ä¼˜å…ˆåŠ è½½
/>
```

### åç«¯ä¼˜åŒ–

1. **AI å“åº”ç¼“å­˜**
```typescript
// lib/ai/cache.ts
const cache = new Map<string, any>();

export async function getCachedAnalysis(paperId: string) {
  if (cache.has(paperId)) {
    return cache.get(paperId);
  }
  
  const result = await analyzePaper(paperId);
  cache.set(paperId, result);
  return result;
}
```

2. **æ•°æ®åº“è¿æ¥æ± **
```typescript
// lib/db/client.ts
import Database from 'better-sqlite3';

let db: Database.Database | null = null;

export function getDB() {
  if (!db) {
    db = new Database('./data/papers.db');
    db.pragma('journal_mode = WAL'); // å¯ç”¨ WAL æ¨¡å¼æå‡æ€§èƒ½
  }
  return db;
}
```

3. **æ‰¹é‡å¤„ç†**
```typescript
// æ‰¹é‡æ’å…¥æ®µè½
export function insertParagraphsBatch(paragraphs: Paragraph[]) {
  const insert = db.prepare(`
    INSERT INTO paragraphs (paper_id, section, order_index, content, translation)
    VALUES (?, ?, ?, ?, ?)
  `);

  const insertMany = db.transaction((items) => {
    for (const item of items) insert.run(item);
  });

  insertMany(paragraphs);
}
```

### AI è°ƒç”¨ä¼˜åŒ–

1. **å¹¶å‘é™åˆ¶**
```typescript
import pLimit from 'p-limit';

const limit = pLimit(3); // æœ€å¤šåŒæ—¶ 3 ä¸ªè¯·æ±‚

const annotations = await Promise.all(
  paragraphs.map(p => limit(() => annotateParagraph(p)))
);
```

2. **æµå¼å“åº”ï¼ˆv2.0ï¼‰**
```typescript
const stream = await openai.chat.completions.create({
  model: MODEL,
  messages: [...],
  stream: true,
});

for await (const chunk of stream) {
  process.stdout.write(chunk.choices[0]?.delta?.content || '');
}
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

```typescript
// tests/unit/pdf-parser.test.ts
import { describe, it, expect } from 'vitest';
import { extractTextFromPDF } from '@/lib/pdf/parser';

describe('PDF Parser', () => {
  it('should extract text from valid PDF', async () => {
    const result = await extractTextFromPDF('./tests/fixtures/sample.pdf');
    expect(result.text).toContain('Abstract');
    expect(result.pageCount).toBeGreaterThan(0);
  });

  it('should throw error for invalid file', async () => {
    await expect(extractTextFromPDF('./invalid.pdf')).rejects.toThrow();
  });
});
```

### é›†æˆæµ‹è¯•

```typescript
// tests/integration/upload-flow.test.ts
describe('Upload Flow', () => {
  it('should complete full upload and analysis', async () => {
    // 1. ä¸Šä¼  PDF
    const formData = new FormData();
    formData.append('file', pdfBlob);
    formData.append('level', 'intermediate');

    const uploadRes = await fetch('/api/upload', {
      method: 'POST',
      body: formData,
    });

    const { paperId } = await uploadRes.json();
    expect(paperId).toBeDefined();

    // 2. ç­‰å¾…åˆ†æå®Œæˆ
    await waitForAnalysis(paperId);

    // 3. è·å–åˆ†æç»“æœ
    const paperRes = await fetch(`/api/papers/${paperId}`);
    const paper = await paperRes.json();

    expect(paper.status).toBe('completed');
    expect(paper.paragraphs.length).toBeGreaterThan(0);
  });
});
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—ç³»ç»Ÿ

```typescript
// lib/utils/logger.ts
export const logger = {
  info: (message: string, meta?: any) => {
    console.log(`[INFO] ${new Date().toISOString()} - ${message}`, meta);
  },
  error: (message: string, error?: Error) => {
    console.error(`[ERROR] ${new Date().toISOString()} - ${message}`, error);
  },
  warn: (message: string, meta?: any) => {
    console.warn(`[WARN] ${new Date().toISOString()} - ${message}`, meta);
  },
};

// ä½¿ç”¨ç¤ºä¾‹
logger.info('PDF uploaded', { paperId, filename });
logger.error('AI analysis failed', error);
```

### æ€§èƒ½ç›‘æ§

```typescript
// lib/utils/performance.ts
export function measurePerformance(name: string) {
  const start = performance.now();
  
  return {
    end: () => {
      const duration = performance.now() - start;
      logger.info(`Performance: ${name}`, { duration: `${duration.toFixed(2)}ms` });
    },
  };
}

// ä½¿ç”¨ç¤ºä¾‹
const perf = measurePerformance('PDF Analysis');
await analyzePaper(paperText);
perf.end();
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥æŒ‡å—

### å¸¸è§é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|---------|---------|
| PDF è§£æå¤±è´¥ | æ–‡ä»¶æŸå/åŠ å¯† | æç¤ºç”¨æˆ·é‡æ–°ä¸Šä¼ æˆ–è§£é™¤åŠ å¯† |
| AI è°ƒç”¨è¶…æ—¶ | ç½‘ç»œé—®é¢˜/æ¨¡å‹ç¹å¿™ | å®ç°é‡è¯•æœºåˆ¶ï¼Œå¢åŠ è¶…æ—¶æ—¶é—´ |
| æ•°æ®åº“é”å®š | å¹¶å‘å†™å…¥å†²çª | å¯ç”¨ WAL æ¨¡å¼ï¼Œä½¿ç”¨äº‹åŠ¡ |
| å†…å­˜æº¢å‡º | å¤§æ–‡ä»¶å¤„ç† | æµå¼å¤„ç†ï¼Œé™åˆ¶æ–‡ä»¶å¤§å° |

---

## ğŸ“… æŠ€æœ¯å€ºåŠ¡å’Œä¼˜åŒ–æ–¹å‘

### v1.0 å·²çŸ¥é™åˆ¶

1. **AI è°ƒç”¨æˆæœ¬é«˜**ï¼šæ¯ç¯‡è®ºæ–‡éœ€å¤šæ¬¡è°ƒç”¨ GPT-4
2. **å¤„ç†é€Ÿåº¦æ…¢**ï¼šé•¿è®ºæ–‡å¯èƒ½éœ€è¦ 2-3 åˆ†é’Ÿ
3. **æ— ç¦»çº¿æ”¯æŒ**ï¼šå¿…é¡»è”ç½‘è°ƒç”¨ AI API
4. **è¯æ±‡åº“ç®€å•**ï¼šåŸºäºè§„åˆ™çš„éš¾è¯åˆ¤æ–­ä¸å¤Ÿæ™ºèƒ½

### v2.0 ä¼˜åŒ–æ–¹å‘

1. **æœ¬åœ° LLM**ï¼šé›†æˆ Llama/Mistral å®ç°ç¦»çº¿åˆ†æ
2. **å‘é‡æ•°æ®åº“**ï¼šä½¿ç”¨ Qdrant å®ç°è¯­ä¹‰æœç´¢
3. **å¢é‡åˆ†æ**ï¼šç¼“å­˜å·²åˆ†ææ®µè½ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
4. **æ™ºèƒ½é¢„åŠ è½½**ï¼šæ ¹æ®é˜…è¯»è¿›åº¦é¢„åŠ è½½ä¸‹ä¸€æ®µçš„åˆ†æç»“æœ

---

## ğŸ“š æŠ€æœ¯å‚è€ƒæ–‡æ¡£

- [Next.js å®˜æ–¹æ–‡æ¡£](https://nextjs.org/docs)
- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [shadcn/ui](https://ui.shadcn.com)
- [better-sqlite3](https://github.com/WiseLibs/better-sqlite3)
- [pdf.js](https://mozilla.github.io/pdf.js/)

---

**æ–‡æ¡£ç»´æŠ¤è€…**ï¼šæŠ€æœ¯å›¢é˜Ÿ  
**æœ€åæ›´æ–°**ï¼š2025-11-19  
**ä¸‹æ¬¡è¯„å®¡**ï¼šå¼€å‘å®Œæˆå

